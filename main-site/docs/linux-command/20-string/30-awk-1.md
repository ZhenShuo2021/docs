---
title: Unix/Linux çš„ awk æŒ‡ä»¤ä½¿ç”¨ï¼ˆä¸Šï¼‰
sidebar_label: awk ä¸Šç¯‡
tags:
  - Linux
  - Cheatsheet
keywords:
  - Linux
last_update:
  date: 2025-05-18T02:11:00+08:00
  author: zsl0621
first_publish:
  date: 2025-05-18T02:11:00+08:00
---

è¦å¯« awk æ•™å­¸æ™‚å…¶å¯¦æˆ‘ä¹Ÿæ˜¯é‚Šå¯«é‚Šå­¸ï¼Œä½†æ˜¯ç™¼ç¾é€™å€‹æŒ‡ä»¤å·²ç¶“ç™¼å±•çš„å¤ªéé¾å¤§ä¸æ˜¯ä¸€ç¯‡ç°¡å–®çš„æ–‡ç« å°±èƒ½æ¸…æ¥šè¡¨é”ï¼Œæ–¼æ˜¯æ±‚åŠ© AIã€‚æ¯”è¼ƒç¶²è·¯æ–‡ç« å’Œ AI ç”Ÿæˆçš„æ–‡ç« ï¼Œæˆ‘å€‹äººèªç‚ºå…§å®¹æ¯”ç¶²è·¯ä¸Šä¹æˆçš„æ•™å­¸éƒ½æ›´æ¸…æ™°ï¼Œæ‰€ä»¥æ¯«ä¸å®¢æ°£çš„çµ¦ AI å¯«ä¸¦ä¸”äººå·¥æ½¤é£¾+æ ¡ç¨¿ï¼Œæœ¬æ–‡ä½¿ç”¨æ­¤ prompt çµ¦ Claude 3.7 ç”Ÿæˆï¼š

<details>

<summary>prompt</summary>

æ’°å¯«awkæŒ‡ä»¤æ•™å­¸ï¼Œå‹™å¿…ç”±æ·ºå…¥æ·±ï¼Œå¾ªåºæ¼¸é€²çš„èªªæ˜ï¼Œå¾ç°¡å–®å¸¸ç”¨çš„åŠŸèƒ½é–‹å§‹ä»‹ç´¹ï¼Œå†é€²å…¥åˆ°ä¸­éšå’Œé«˜éšç”¨æ³•ã€‚é‡åˆ°æ–°çš„èªæ³•å¿…é ˆè©³ç´°èªªæ˜ç¬¦è™Ÿç”¨é€”ã€‚
æ­¤æ•™å­¸è¦æ±‚ä»¥ä¸‹çµ„æˆï¼š

1. æ¯æ¬¡å°è©±çš„ä¸»æ¨™é¡Œæ˜¯h2ï¼Œæ¯å€‹å…§å®¹æ˜¯h3ï¼Œæ¯å€‹h2æ¨™é¡Œä½¿ç”¨emoji: ğŸ“˜ï¼Œå…¶ä»–æ¨™é¡Œä¸å¯æœ‰emojiï¼Œå…§å®¹ä½¿ç”¨ç¹é«”ä¸­æ–‡
2. **çµ•å°ç¦æ­¢ä½¿ç”¨h4æ¨™é¡Œï¼Œä¹Ÿå°±æ˜¯èªªåš´å²ç¦æ­¢å‡ºç¾4å€‹#é–‹é ­çš„å…§å®¹**ï¼Œ**ç¦æ­¢ä½¿ç”¨ç¨ç«‹æ®µè½ä»‹ç´¹æŒ‡ä»¤ç¯„ä¾‹ï¼Œå¿…é ˆå’Œåƒæ•¸ä¸€åŒå‡ºç¾åŒæ™‚ä»‹ç´¹**ã€‚
3. æ•™å­¸è³‡è¨Šå¯†åº¦é«˜ï¼Œå…§å®¹ç·Šæ¹Šï¼Œç¢ºä¿é¡ä¼¼åŠŸèƒ½åœ¨åŒä¸€å€‹ä¸Šä¸‹æ–‡ï¼Œç¯„ä¾‹æŒ‡ä»¤ç°¡æ½”æ˜“æ‡‚ï¼Œè¼¸å‡ºç²¾ç°¡ï¼Œç”¨æ³•ç¬¦åˆå·¥ç¨‹å¯¦å‹™ã€‚

ä½¿ç”¨æ­¤nginx log.txtä½œç‚ºç¯„ä¾‹æ–‡æœ¬ï¼Œä¹‹å¾Œæ‰€æœ‰å…§å®¹å…¨éƒ¨åŸºæ–¼æ­¤æ–‡æœ¬æ¸¬è©¦

```txt
192.168.0.101 - - [17/May/2025:21:14:12 +0000] "GET / HTTP/1.1" 200 1536 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64)" "-"

192.168.0.101 - - [17/May/2025:21:16:44 +0000] "GET /dashboard HTTP/1.1" 200 4721 "https://example.com/" "Mozilla/5.0 (iPhone; CPU iPhone OS 16_4 like Mac OS X)" "-"

203.0.113.45 - john [17/May/2025:21:15:30 +0000] "POST /login HTTP/1.1" 302 423 "https://example.com/login" "Mozilla/5.0 (Macintosh; Intel Mac OS X 12_6)" "198.51.100.23"

10.1.2.3 - - [17/May/2025:21:17:10 +0000] "GET /assets/css/style.css HTTP/1.1" 304 0 "https://example.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64)" "-"

172.16.4.5 - alice [17/May/2025:21:18:57 +0000] "DELETE /api/user/321 HTTP/1.1" 403 732 "-" "PostmanRuntime/7.30.0" "172.16.4.5"

203.0.113.45 - john [18/May/2025:09:01:11 +0000] "POST /api/upload HTTP/1.1" 201 9832 "https://example.com/upload" "curl/7.68.0" "-"
```

æ–‡ç« ç·¨æ’æœ‰åŸºç¤(800å­—)ã€ä¸­éš1(1000å­—)ã€ä¸­éš2(1000å­—)ã€é«˜éš(800å­—)å››å€‹ç¯‡ç« ï¼Œå…§å®¹é•·åº¦800å­—ï¼Œå…§å®¹ä»¥code blocké¡¯ç¤ºï¼Œä¸è¦æ”¾åœ¨å°è©±æ¡†ï¼ŒåŸºç¤ç¯‡åªèƒ½åŒ…å«æœ€ç°¡æ˜“ä½¿ç”¨ï¼Œä»»ä½•æ¢ä»¶åˆ¤æ–·å’Œè®Šæ•¸éƒ½ç•™åˆ°ä¸­éšç¯‡ä»‹ç´¹ã€‚

å…ˆç”Ÿæˆæ®µè½è¦åŠƒè®“æˆ‘æª¢æŸ¥æ˜¯å¦ç¬¦åˆè¦æ±‚ã€‚

</details>

<details>

<summary>å®Œæ•´çš„ log.txt</summary>

ä½¿ç”¨é€™ä»½ log.txt å¯ä»¥æ¸¬è©¦æ›´é•·æ–‡ä»¶çš„åŸ·è¡Œçµæœã€‚

```txt
192.168.0.101 - - [17/May/2025:21:14:12 +0000] "GET / HTTP/1.1" 200 1536 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64)" "-"
192.168.0.101 - - [17/May/2025:21:16:44 +0000] "GET /dashboard HTTP/1.1" 200 4721 "https://example.com/" "Mozilla/5.0 (iPhone; CPU iPhone OS 16_4 like Mac OS X)" "-"
203.0.113.45 - john [17/May/2025:21:15:30 +0000] "POST /login HTTP/1.1" 302 423 "https://example.com/login" "Mozilla/5.0 (Macintosh; Intel Mac OS X 12_6)" "198.51.100.23"
10.1.2.3 - - [17/May/2025:21:17:10 +0000] "GET /assets/css/style.css HTTP/1.1" 304 0 "https://example.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64)" "-"
172.16.4.5 - alice [17/May/2025:21:18:57 +0000] "DELETE /api/user/321 HTTP/1.1" 403 732 "-" "PostmanRuntime/7.30.0" "172.16.4.5"
203.0.113.45 - john [18/May/2025:09:01:11 +0000] "POST /api/upload HTTP/1.1" 201 9832 "https://example.com/upload" "curl/7.68.0" "-"
10.1.2.3 - - [18/May/2025:09:02:28 +0000] "GET /favicon.ico HTTP/1.1" 404 209 "-" "Mozilla/5.0 (Windows NT 6.1; WOW64)" "-"
198.18.0.10 - - [18/May/2025:09:03:33 +0000] "PUT /api/item/789 HTTP/1.1" 500 1177 "https://admin.example.com/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 13_3_1)" "-"
192.168.0.101 - root [18/May/2025:09:04:48 +0000] "GET /admin HTTP/1.1" 401 512 "-" "Wget/1.21.1 (linux-gnu)" "127.0.0.1"
145.23.65.8 - - [18/May/2025:09:05:59 +0000] "GET /search?q=test HTTP/2.0" 200 2981 "https://example.com/search" "Mozilla/5.0 (X11; Linux x86_64)" "-"
203.0.113.45 - - [18/May/2025:09:07:10 +0000] "PATCH /api/settings HTTP/1.1" 204 0 "https://example.com/settings" "Mozilla/5.0 (iPad; CPU OS 14_6 like Mac OS X)" "-"
10.1.2.3 - - [18/May/2025:09:08:25 +0000] "OPTIONS /api/data HTTP/1.1" 204 0 "-" "Mozilla/5.0 (Android 12; Mobile)" "-"
192.168.0.101 - - [19/May/2025:10:15:03 +0000] "GET /products HTTP/1.1" 200 3874 "https://example.com/home" "Mozilla/5.0 (Windows NT 10.0; Win64; x64)" "-"
203.0.113.45 - john [19/May/2025:10:16:45 +0000] "POST /checkout HTTP/1.1" 302 541 "https://example.com/cart" "Mozilla/5.0 (Macintosh; Intel Mac OS X 12_6)" "-"
172.16.4.5 - alice [19/May/2025:10:18:01 +0000] "DELETE /api/session HTTP/1.1" 403 691 "-" "PostmanRuntime/7.30.0" "-"
198.18.0.10 - - [19/May/2025:10:20:15 +0000] "PUT /api/item/222 HTTP/1.1" 500 1093 "https://admin.example.com/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 13_3_1)" "-"
203.0.113.45 - john [19/May/2025:10:21:33 +0000] "POST /logout HTTP/1.1" 200 212 "https://example.com/profile" "Mozilla/5.0 (Macintosh; Intel Mac OS X 12_6)" "-"
10.1.2.3 - - [19/May/2025:10:22:47 +0000] "GET /assets/js/app.js HTTP/1.1" 304 0 "https://example.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64)" "-"
192.168.0.101 - - [19/May/2025:10:23:59 +0000] "GET /about HTTP/1.1" 200 1432 "https://example.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64)" "-"
145.23.65.8 - - [19/May/2025:10:25:03 +0000] "HEAD /ping HTTP/1.1" 200 0 "-" "curl/7.79.1" "-"
198.51.100.23 - - [19/May/2025:10:26:44 +0000] "GET /blog HTTP/1.1" 200 6783 "https://example.com/" "Mozilla/5.0 (X11; Linux x86_64)" "-"
172.16.4.5 - alice [19/May/2025:10:27:55 +0000] "POST /api/comment HTTP/1.1" 201 998 "https://example.com/post/123" "PostmanRuntime/7.30.0" "-"
192.168.0.101 - root [19/May/2025:10:29:12 +0000] "GET /admin/logs HTTP/1.1" 403 1243 "-" "Wget/1.21.1 (linux-gnu)" "127.0.0.1"
10.1.2.3 - - [19/May/2025:10:30:38 +0000] "GET /robots.txt HTTP/1.1" 200 68 "-" "Mozilla/5.0 (Windows NT 6.1; Win64; x64)" "-"
203.0.113.45 - - [19/May/2025:10:32:17 +0000] "PUT /api/profile HTTP/1.1" 200 1543 "https://example.com/settings" "Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X)" "-"
198.18.0.10 - - [19/May/2025:10:34:05 +0000] "DELETE /api/item/333 HTTP/1.1" 404 213 "https://admin.example.com/items" "Mozilla/5.0 (Macintosh; Intel Mac OS X 13_3_1)" "-"
```

</details>

ç¯„ä¾‹å…§å®¹ä½¿ç”¨ Nginx log æ¯”è¼ƒç¬¦åˆç¾å¯¦ä¸–ç•Œï¼Œæœ‰æ–‡ç« æ‹¿ csv ä½œç¯„ä¾‹è¶…å¥‡æ€ªï¼Œéƒ½å·²ç¶“ç”¨ csv äº†ç‚ºä»€éº¼ä¸ç”¨å°ˆé–€å·¥å…· ([mlr](https://github.com/johnkerl/miller), [qsv](https://github.com/dathere/qsv), [csvkit](https://github.com/wireservice/csvkit)) ååè¦ç”¨ awk ä¾†è™å¾…è‡ªå·±ï¼Œè€Œä¸”ç”¨ awk è§£æ csv è¦æ±‚ä»»ä½•æ¬„ä½éƒ½ä¸å¯å‡ºç¾ç‰¹æ®Šå­—ç¬¦ï¼Œä¸€å‡ºç¾ç›´æ¥ä»£è¡¨è§£æéŒ¯èª¤ã€‚å‰è¨€çµæŸï¼Œä»¥ä¸‹é–‹å§‹ AI çš„è¡¨æ¼”ã€‚

## ğŸ“˜ AWK åŸºç¤ç¯‡

> å¦‚æœæœ‰æŒ‡ä»¤ä¸èƒ½åŸ·è¡Œï¼Œè«‹å®‰è£ gnu ç‰ˆæœ¬çš„ awkï¼Œmacos è«‹ä½¿ç”¨ `brew install gawk` å®‰è£ä¸¦æ”¹ç‚º gawkã€‚

### AWK ç°¡ä»‹èˆ‡åŸºæœ¬æ¦‚å¿µ

AWK æ˜¯ä¸€ç¨®å¼·å¤§çš„æ–‡æœ¬è™•ç†èªè¨€ï¼Œç‰¹åˆ¥é©åˆç”¨æ–¼çµæ§‹åŒ–æ–‡æœ¬çš„è™•ç†èˆ‡åˆ†æã€‚å®ƒçš„åç¨±ä¾†è‡ªæ–¼ä¸‰ä½å‰µå§‹äºº Alfred **A**hoã€Peter **W**einberger å’Œ Brian **K**ernighan çš„å§“æ°é¦–å­—æ¯ã€‚AWK çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°‡æ–‡æœ¬æª”æ¡ˆè¦–ç‚º**è¡Œå’Œæ¬„ä½**ï¼Œä¸¦æä¾›ç°¡ä¾¿çš„æ–¹å¼å°é€™äº›æ•¸æ“šé€²è¡Œæ“ä½œã€‚

:::tip
awk çš„åŸºç¤é‚è¼¯æ˜¯**æ¯æ¬¡è™•ç†ä¸€è¡Œ**ï¼Œæ¯è¡Œè¦–ç‚º**å¤šå€‹ä¸åŒæ¬„ä½**ï¼Œæ¬„ä½ä¹‹é–“ä½¿ç”¨åˆ†éš”ç¬¦ (delimiter) åˆ†é–‹ï¼Œé è¨­æ˜¯ç©ºéš”ã€‚

å­¸ç¿’ awk æ™‚è¦è¨˜å¾—ä»–å¾ˆå¤§ç¨‹åº¦ä¸Šåƒè€ƒäº† C èªè¨€ï¼Œæœ‰äº†é€™å€‹å‰æå¾Œé–±è®€ä¸­éšç¯‡å°±æœƒéå¸¸è¼•é¬†ã€‚
:::

### åŸºæœ¬èªæ³•çµæ§‹

AWK å‘½ä»¤çš„åŸºæœ¬çµæ§‹å¦‚ä¸‹ï¼š

```bash
awk 'æ¨¡å¼ {å‹•ä½œ}' æª”æ¡ˆåç¨±
```

å…¶ä¸­ï¼š

- `æ¨¡å¼`ï¼šæ±ºå®šä½•æ™‚åŸ·è¡Œå‹•ä½œï¼Œå¯ä»¥æ˜¯æ¢ä»¶ã€æ­£å‰‡è¡¨é”å¼æˆ–ç‰¹æ®Šæ¨¡å¼
- `å‹•ä½œ`ï¼šç•¶æ¨¡å¼åŒ¹é…æ™‚è¦åŸ·è¡Œçš„æ“ä½œï¼Œé€šå¸¸åŒ…å«åœ¨å¤§æ‹¬è™Ÿå…§
- `æª”æ¡ˆåç¨±`ï¼šè¦è™•ç†çš„æª”æ¡ˆ

åŸºæœ¬ç”¨æ³•ç¯„ä¾‹ï¼Œå°å‡ºæ‰€æœ‰è¡Œï¼š

```bash
awk '{print}' log.txt
```

### æ¬„ä½è™•ç†

AWK æœ€å¼·å¤§çš„åŠŸèƒ½ä¹‹ä¸€æ˜¯è™•ç†æ–‡æœ¬çš„æ¬„ä½ã€‚é»˜èªæƒ…æ³ä¸‹ï¼ŒAWK ä½¿ç”¨ç©ºç™½ï¼ˆç©ºæ ¼ã€tabï¼‰ä½œç‚ºæ¬„ä½åˆ†éš”ç¬¦ã€‚

- `$0`ï¼šä»£è¡¨æ•´è¡Œå…§å®¹
- `$1`ï¼šç¬¬ä¸€å€‹æ¬„ä½
- `$2`ï¼šç¬¬äºŒå€‹æ¬„ä½
- `$NF`ï¼šæœ€å¾Œä¸€å€‹æ¬„ä½

ä½¿ç”¨ç¯„ä¾‹ï¼Œå°å‡ºæ—¥èªŒæª”çš„ IP åœ°å€å’Œæ™‚é–“ï¼š

```bash
awk '{print $1, $6}' log.txt
```

è¼¸å‡ºç‚ºï¼š

```txt
192.168.0.101 [17/May/2025:21:14:12
192.168.0.101 [17/May/2025:21:16:44
203.0.113.45 [17/May/2025:21:15:30
...
```

ç§»é™¤å‰ä¸‰æ¬„ï¼š

```bash
# ç®¡é“ç¬¦å¾Œçš„ sed ç”¨æ–¼ç§»é™¤ç©ºç™½
awk '{$1=$2=$3=""; print $0}' log.txt | sed 's/^ *//'
```

è¼¸å‡ºç‚ºï¼š

```txt
[17/May/2025:21:14:12 +0000] "GET / HTTP/1.1" 200 1536 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64)" "-"
[17/May/2025:21:16:44 +0000] "GET /dashboard HTTP/1.1" 200 4721 "https://example.com/" "Mozilla/5.0 (iPhone; CPU iPhone OS 16_4 like Mac OS X)" "-"
[17/May/2025:21:15:30 +0000] "POST /login HTTP/1.1" 302 423 "https://example.com/login" "Mozilla/5.0 (Macintosh; Intel Mac OS X 12_6)" "198.51.100.23"
...
```

ä¿®æ”¹æ¬„ä½åˆ†éš”ç¬¦ï¼š

```bash
awk -F"[: ]" '{print NF}' log.txt
```

`-F"[: ]"` æŒ‡å®šä»¥å†’è™Ÿå’Œç©ºæ ¼ä½œç‚ºåˆ†éš”ç¬¦ï¼Œå°å‡º NF æŸ¥çœ‹åˆ†éš”å¾Œçš„æ¬„ä½æ•¸é‡ã€‚

### å…§å»ºè®Šæ•¸

AWK æä¾›äº†è¨±å¤šå…§å»ºè®Šæ•¸ï¼Œä½¿æ–‡æœ¬è™•ç†æ›´åŠ ä¾¿æ·ï¼š

:::tip awk çš„å…§å»ºè®Šæ•¸

- `NR`ï¼šç•¶å‰è™•ç†çš„è¨˜éŒ„ï¼ˆè¡Œï¼‰ç·¨è™Ÿ
- `NF`ï¼šç•¶å‰è¨˜éŒ„çš„æ¬„ä½æ•¸é‡
- `FS`ï¼šè¼¸å…¥æ¬„ä½åˆ†éš”ç¬¦ï¼ˆé»˜èªç‚ºç©ºç™½ï¼‰
- `OFS`ï¼šè¼¸å‡ºæ¬„ä½åˆ†éš”ç¬¦ï¼ˆé»˜èªç‚ºç©ºæ ¼ï¼‰
- `RS`ï¼šè¼¸å…¥è¨˜éŒ„åˆ†éš”ç¬¦ï¼ˆé»˜èªç‚ºæ›è¡Œç¬¦ï¼‰
- `ORS`ï¼šè¼¸å‡ºè¨˜éŒ„åˆ†éš”ç¬¦ï¼ˆé»˜èªç‚ºæ›è¡Œç¬¦ï¼‰

:::

å¸¶è¡Œè™Ÿé¡¯ç¤ºæ—¥èªŒï¼š

```bash
awk '{print NR, $0}' log.txt
```

è¼¸å‡ºï¼š

```txt
1 192.168.0.101 - - [17/May/2025:21:14:12 +0000] "GET / HTTP/1.1" 200 1536 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64)" "-"
2 192.168.0.101 - - [17/May/2025:21:16:44 +0000] "GET /dashboard HTTP/1.1" 200 4721 "https://example.com/" "Mozilla/5.0 (iPhone; CPU iPhone OS 16_4 like Mac OS X)" "-"
...
```

é¡¯ç¤ºæ¯è¡Œæ¬„ä½æ•¸ï¼š

```bash
awk '{print NF}' log.txt
```

ä½¿ç”¨ NF å°å‡ºæœ€å¾Œä¸€å€‹æ¬„ä½ï¼š

```bash
awk '{print $NF}' log.txt
```

### ç°¡å–®çš„è¼¸å‡ºæ ¼å¼åŒ–

AWK æä¾›å…©ç¨®ä¸»è¦çš„è¼¸å‡ºå‘½ä»¤ï¼š`print` å’Œ `printf`ã€‚

`print` ç°¡å–®æ˜“ç”¨ï¼Œæœƒè‡ªå‹•åœ¨æ¯å€‹è¼¸å‡ºå¾Œæ·»åŠ æ›è¡Œç¬¦ï¼š

```bash
awk '{print "IP:", $1, "ç‹€æ…‹ç¢¼:", $9}' log.txt
```

è¼¸å‡ºï¼š

```txt
IP: 192.168.0.101 ç‹€æ…‹ç¢¼: 200
IP: 192.168.0.101 ç‹€æ…‹ç¢¼: 200
IP: 203.0.113.45 ç‹€æ…‹ç¢¼: 302
IP: 10.1.2.3 ç‹€æ…‹ç¢¼: 304
IP: 172.16.4.5 ç‹€æ…‹ç¢¼: 403
IP: 203.0.113.45 ç‹€æ…‹ç¢¼: 201
```

`printf` æä¾›æ›´ç²¾ç¢ºçš„æ ¼å¼æ§åˆ¶ï¼Œé¡ä¼¼æ–¼ C èªè¨€çš„ printfï¼š

```bash
awk '{printf "%-15s %s\n", $1, $9}' log.txt
```

è¼¸å‡ºï¼š

```txt
192.168.0.101   200
192.168.0.101   200
203.0.113.45    302
10.1.2.3        304
172.16.4.5      403
203.0.113.45    201
```

å…¶ä¸­ï¼š

- `%-15s`ï¼šå·¦å°é½Šçš„ 15 å­—å…ƒå¯¬åº¦çš„å­—ä¸²
- `%s`ï¼šå­—ä¸²
- `\n`ï¼šæ›è¡Œï¼ˆä½¿ç”¨ printf æ™‚éœ€è¦æ‰‹å‹•æ·»åŠ æ›è¡Œç¬¦ï¼‰

ä»¥è¡¨æ ¼å½¢å¼é¡¯ç¤º IP å’Œ HTTP ç‹€æ…‹ï¼š

```bash
awk 'BEGIN {printf "%-15s %s\n", "IP", "ç‹€æ…‹ç¢¼"} {printf "%-15s %s\n", $1, $9}' log.txt
```

è¼¸å‡ºï¼š

```txt
IP             ç‹€æ…‹ç¢¼
192.168.0.101   200
192.168.0.101   200
203.0.113.45    302
10.1.2.3        304
172.16.4.5      403
203.0.113.45    201
```

é€™äº›åŸºæœ¬åŠŸèƒ½å·²ç¶“èƒ½å¤ è®“æ‚¨åœ¨æ—¥å¸¸å·¥ä½œä¸­è™•ç†å¤§å¤šæ•¸çš„æ–‡æœ¬æ ¼å¼åŒ–å’Œæ•¸æ“šæå–ä»»å‹™ã€‚

## ğŸ“˜ AWK ä¸­éšç¯‡ 1

### æ–‡æœ¬éæ¿¾

AWK å¼·å¤§ä¹‹è™•åœ¨æ–¼èƒ½å¤ æ ¹æ“šç‰¹å®šæ¢ä»¶éæ¿¾æ–‡æœ¬ã€‚éæ¿¾æ˜¯é€éåœ¨ AWK å‘½ä»¤ä¸­æŒ‡å®šæ¨¡å¼ä¾†å¯¦ç¾çš„ã€‚åªæœ‰ç•¶æ¨¡å¼åŒ¹é…æˆåŠŸæ™‚ï¼Œç›¸æ‡‰çš„æ“ä½œæ‰æœƒåŸ·è¡Œã€‚

å°å‡ºç‹€æ…‹ç¢¼ç‚º 200 çš„è«‹æ±‚ï¼š

```bash
awk '$9 == "200" {print $0}' log.txt
```

è¼¸å‡ºï¼š

```txt
192.168.0.101 - - [17/May/2025:21:14:12 +0000] "GET / HTTP/1.1" 200 1536 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64)" "-"
192.168.0.101 - - [17/May/2025:21:16:44 +0000] "GET /dashboard HTTP/1.1" 200 4721 "https://example.com/" "Mozilla/5.0 (iPhone; CPU iPhone OS 16_4 like Mac OS X)" "-"
```

å°å‡º HTTP æ–¹æ³•ç‚º POST çš„è«‹æ±‚ï¼ˆæ³¨æ„é€™è£¡ $6 åŒ…å«é›™å¼•è™Ÿï¼‰ï¼š

```bash
awk '$6 == "\"POST" {print $1, $6, $7}' log.txt
```

è¼¸å‡ºï¼š

```txt
203.0.113.45 "POST /login
203.0.113.45 "POST /api/upload
```

### æ¨¡å¼åŒ¹é…é€²éš (æ­£å‰‡è¡¨é”å¼)

AWK æ”¯æ´ä½¿ç”¨æ­£å‰‡è¡¨é”å¼é€²è¡Œæ›´è¤‡é›œçš„åŒ¹é…ã€‚ä½¿ç”¨ `/æ­£å‰‡è¡¨é”å¼/` èªæ³•å¯ä»¥åŒ¹é…æ–‡æœ¬ã€‚

:::tip å¸¸ç”¨çš„æ­£å‰‡è¡¨é”å¼ç¬¦è™Ÿ

- `.`ï¼šåŒ¹é…ä»»ä½•å–®å€‹å­—ç¬¦
- `*`ï¼šåŒ¹é…å‰ä¸€å€‹å­—ç¬¦é›¶æ¬¡æˆ–å¤šæ¬¡
- `+`ï¼šåŒ¹é…å‰ä¸€å€‹å­—ç¬¦ä¸€æ¬¡æˆ–å¤šæ¬¡
- `?`ï¼šåŒ¹é…å‰ä¸€å€‹å­—ç¬¦é›¶æ¬¡æˆ–ä¸€æ¬¡
- `^`ï¼šåŒ¹é…è¡Œé¦–
- `$`ï¼šåŒ¹é…è¡Œå°¾
- `[]`ï¼šåŒ¹é…å­—ç¬¦é›†ä¸­çš„ä»»ä½•å­—ç¬¦
- `()`ï¼šåˆ†çµ„
- `|`ï¼šæˆ–æ“ä½œ

å®Œæ•´åˆ—è¡¨è«‹è¦‹[æ­£å‰‡è¡¨é”å¼ cheatsheet](/linux-command/regex)ã€‚

:::

æ‰¾å‡ºæ‰€æœ‰ä½¿ç”¨ Windowsï¼Œä¸”åŒ…å«ç‰ˆæœ¬è™Ÿç¢¼çš„è«‹æ±‚ï¼š

```bash
awk '/Windows.*[0-9]{1,}/ {print $0}' log.txt
```

è¼¸å‡ºï¼š

```txt
192.168.0.101 - - [17/May/2025:21:14:12 +0000] "GET / HTTP/1.1" 200 1536 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64)" "-"
10.1.2.3 - - [17/May/2025:21:17:10 +0000] "GET /assets/css/style.css HTTP/1.1" 304 0 "https://example.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64)" "-"
```

çµ„åˆä½¿ç”¨æ­£å‰‡è¡¨é”å¼å’Œæ¬„ä½æ¢ä»¶ï¼š

```bash
awk '/GET/ && $9 == "304" {print "ç·©å­˜å‘½ä¸­:", $7}' log.txt
```

è¼¸å‡ºï¼š

```txt
ç·©å­˜å‘½ä¸­: /assets/css/style.css
```

åŒ¹é…ç‰¹å®šæ—¥æœŸçš„è«‹æ±‚ï¼š

```bash
awk '$4 ~ /18\/May\/2025/ {print "æ—¥æœŸ:", $4, "IP:", $1}' log.txt
```

è¼¸å‡ºï¼š

```txt
æ—¥æœŸ: [18/May/2025:09:01:11 IP: 203.0.113.45
```

å…¶ä¸­ï¼Œ`~` é‹ç®—ç¬¦ç”¨æ–¼æ­£å‰‡è¡¨é”å¼åŒ¹é…ï¼Œ`!~` é‹ç®—ç¬¦ç”¨æ–¼æ­£å‰‡è¡¨é”å¼ä¸åŒ¹é…ã€‚

### BEGIN èˆ‡ END å€å¡Š

AWK æä¾›äº†å…©ç¨®ç‰¹æ®Šæ¨¡å¼ï¼šBEGIN å’Œ ENDã€‚

- `BEGIN {å‹•ä½œ}`ï¼šåœ¨è™•ç†ä»»ä½•è¼¸å…¥è¡Œä¹‹å‰åŸ·è¡Œ
- `END {å‹•ä½œ}`ï¼šåœ¨è™•ç†æ‰€æœ‰è¼¸å…¥è¡Œä¹‹å¾ŒåŸ·è¡Œ

é€™äº›å€å¡Šç‰¹åˆ¥é©åˆç”¨æ–¼åˆå§‹åŒ–è®Šæ•¸å’Œè¼¸å‡ºçµæœæ‘˜è¦ã€‚

é¡¯ç¤ºè«‹æ±‚çµ±è¨ˆï¼š

```bash
awk 'BEGIN {print "é–‹å§‹åˆ†ææ—¥èªŒ..."; count=0} $9 == "200" {count++} END {print "å…±æœ‰", count, "å€‹æˆåŠŸè«‹æ±‚"}' log.txt
```

è¼¸å‡ºï¼š

```txt
é–‹å§‹åˆ†ææ—¥èªŒ...
å…±æœ‰ 2 å€‹æˆåŠŸè«‹æ±‚
```

ç”¨æ–¼ç”Ÿæˆè¡¨é ­å’Œè¡¨å°¾çš„å ±å‘Šï¼š

```bash
awk 'BEGIN {print "IPåœ°å€\t\tç‹€æ…‹ç¢¼\tURI"} {printf "%s\t%s\t%s\n", $1, $9, $7} END {print "--- æ—¥èªŒåˆ†æå®Œæˆ ---"}' log.txt
```

### æ¢ä»¶åˆ¤æ–·çµæ§‹ (if-else)

AWK æ”¯æ´ if-else æ¢ä»¶çµæ§‹ï¼Œä¾‹å¦‚å¯ä»¥æ ¹æ“šç‹€æ…‹ç¢¼åˆ†é¡è«‹æ±‚ï¼š

```bash
awk '{
    if ($9 >= 200 && $9 < 300) {
        print $1, "æˆåŠŸè«‹æ±‚:", $9
    } else if ($9 >= 300 && $9 < 400) {
        print $1, "é‡å®šå‘:", $9
    } else if ($9 >= 400 && $9 < 500) {
        print $1, "å®¢æˆ¶ç«¯éŒ¯èª¤:", $9
    }
}' log.txt
```

è¼¸å‡ºï¼š

```txt
192.168.0.101 æˆåŠŸè«‹æ±‚: 200
192.168.0.101 æˆåŠŸè«‹æ±‚: 200
203.0.113.45 é‡å®šå‘: 302
10.1.2.3 é‡å®šå‘: 304
172.16.4.5 å®¢æˆ¶ç«¯éŒ¯èª¤: 403
203.0.113.45 æˆåŠŸè«‹æ±‚: 201
```

ä½¿ç”¨ if åˆ¤æ–·ç‰¹å®šæ¬„ä½ï¼š

```bash
awk '{
    method = $6
    gsub(/\"/, "", method)  # å»é™¤å¼•è™Ÿ
    if (method == "GET") {
        print "GET è«‹æ±‚:", $7
    } else if (method == "POST") {
        print "POST è«‹æ±‚:", $7
    } else if (method == "DELETE") {
        print "åˆªé™¤è«‹æ±‚:", $7
    }
}' log.txt
```

### è¿´åœˆçµæ§‹ (for, while)

AWK æ”¯æ´ä½¿ç”¨ for å’Œ while è¿´åœˆé€²è¡Œé‡è¤‡æ“ä½œï¼š

for è¿´åœˆåŸºæœ¬èªæ³•ï¼š

```txt
for (åˆå§‹åŒ–; æ¢ä»¶; å¢é‡) {
    å‹•ä½œ
}
```

while è¿´åœˆåŸºæœ¬èªæ³•ï¼š

```txt
while (æ¢ä»¶) {
    å‹•ä½œ
}
```

è™•ç†æ¯è¡Œçš„æ¯å€‹æ¬„ä½ï¼š

```bash
awk '{
    print "è¡Œ " NR " æœ‰ " NF " å€‹æ¬„ä½:"
    for (i = 1; i <= 3; i++) {
        print "  æ¬„ä½ " i ": " $i
    }
}' log.txt
```

ä½¿ç”¨ while è¿´åœˆï¼š

```bash
awk '{
    i = 1
    while (i <= 3) {
        print "è¡Œ " NR ", æ¬„ä½ " i ": " $i
        i++
    }
}' log.txt
```

å°å‡ºç¬¬å››æ¬„ä¹‹å¾Œçš„å…§å®¹ï¼š

```sh
awk '{
  for (i = 4; i <= NF; i++) { printf("%s", $i) }
  printf("\n")
}' log.txt
```

### è®Šæ•¸ä½¿ç”¨èˆ‡æ“ä½œ

AWK ä¸­çš„è®Šæ•¸ä¸éœ€è¦é å…ˆè²æ˜ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚è®Šæ•¸åç¨±å€åˆ†å¤§å°å¯«ã€‚

åŸºæœ¬è®Šæ•¸è³¦å€¼ï¼š

```bash
awk '{
    total_bytes = $10
    request_path = $7
    print "è·¯å¾‘:", request_path, "å¤§å°:", total_bytes, "ä½å…ƒçµ„"
}' log.txt
```

è¼¸å‡ºï¼š

```txt
è·¯å¾‘: / å¤§å°: 1536 ä½å…ƒçµ„
è·¯å¾‘: /dashboard å¤§å°: 4721 ä½å…ƒçµ„
è·¯å¾‘: /login å¤§å°: 423 ä½å…ƒçµ„
è·¯å¾‘: /assets/css/style.css å¤§å°: 0 ä½å…ƒçµ„
è·¯å¾‘: /api/user/321 å¤§å°: 732 ä½å…ƒçµ„
è·¯å¾‘: /api/upload å¤§å°: 9832 ä½å…ƒçµ„
```

ç´¯åŠ è¨ˆç®—ç¸½ä½å…ƒçµ„ï¼š

```bash
awk 'BEGIN {total = 0} {total += $10} END {print "ç¸½å‚³è¼¸é‡:", total, "ä½å…ƒçµ„"}' log.txt
```

è¼¸å‡ºï¼š

```txt
ç¸½å‚³è¼¸é‡: 17244 ä½å…ƒçµ„
```

å­—ä¸²é€£æ¥ï¼š

```bash
awk '{
    date_str = $4
    ip_addr = $1
    full_info = ip_addr " åœ¨ " date_str " è¨ªå•äº†ç¶²ç«™"
    print full_info
}' log.txt
```

è¼¸å‡ºï¼š

```txt
192.168.0.101 åœ¨ [17/May/2025:21:14:12 è¨ªå•äº†ç¶²ç«™
192.168.0.101 åœ¨ [17/May/2025:21:16:44 è¨ªå•äº†ç¶²ç«™
203.0.113.45 åœ¨ [17/May/2025:21:15:30 è¨ªå•äº†ç¶²ç«™
10.1.2.3 åœ¨ [17/May/2025:21:17:10 è¨ªå•äº†ç¶²ç«™
172.16.4.5 åœ¨ [17/May/2025:21:18:57 è¨ªå•äº†ç¶²ç«™
203.0.113.45 åœ¨ [18/May/2025:09:01:11 è¨ªå•äº†ç¶²ç«™
```

è®Šæ•¸ä½¿ç”¨æ–¼æ¢ä»¶ä¸­ï¼š

```bash
awk '{
    status = $9
    size = $10
    if (status == "200" && size > 1000) {
        print "å¤§å‹æˆåŠŸéŸ¿æ‡‰:", $7, size, "ä½å…ƒçµ„"
    } else if (status == "304") {
        print "ç·©å­˜å‘½ä¸­:", $7
    }
}' log.txt
```

è¼¸å‡ºï¼š

```txt
å¤§å‹æˆåŠŸéŸ¿æ‡‰: / 1536 ä½å…ƒçµ„
å¤§å‹æˆåŠŸéŸ¿æ‡‰: /dashboard 4721 ä½å…ƒçµ„
ç·©å­˜å‘½ä¸­: /assets/css/style.css
å¤§å‹æˆåŠŸéŸ¿æ‡‰: /api/upload 9832 ä½å…ƒçµ„
```

### AWK èˆ‡ç®¡é“é€£ç”¨

AWK å¯ä»¥èˆ‡ Unix/Linux ç®¡é“é…åˆï¼Œå¯¦ç¾å¼·å¤§çš„æ–‡æœ¬è™•ç†æµç¨‹ã€‚ç®¡é“æ“ä½œç¬¦ `|` å¯ä»¥å°‡ä¸€å€‹å‘½ä»¤çš„è¼¸å‡ºä½œç‚ºå¦ä¸€å€‹å‘½ä»¤çš„è¼¸å…¥ã€‚

æ­é… grep é éæ¿¾æ—¥èªŒï¼š

```bash
grep "GET" log.txt | awk '{print $1, $9, $7}'
```

è¼¸å‡ºï¼š

```txt
192.168.0.101 200 /
192.168.0.101 200 /dashboard
10.1.2.3 304 /assets/css/style.css
```

å…ˆç”¨ awk è™•ç†ï¼Œå†ç”¨ sort æ’åºï¼š

```bash
awk '$9 >= 200 {print $9, $7}' log.txt | sort -n
```

è¼¸å‡ºï¼š

```txt
403 /api/user/321
```

è¨ˆç®—æ¯å€‹ IP åœ°å€çš„è«‹æ±‚æ¬¡æ•¸ä¸¦æ’åºï¼š

```bash
awk '{print $1}' log.txt | sort | uniq -c | sort -nr
```

è¼¸å‡ºï¼š

```txt
   2 203.0.113.45
   2 192.168.0.101
   1 172.16.4.5
   1 10.1.2.3
```

AWK è¼¸å‡ºåˆ°ç®¡é“ï¼Œå†ç”¨ awk äºŒæ¬¡è™•ç†ï¼š

```bash
awk '{print $1, $9}' log.txt | awk '$2 >= 300 {print "ç‹€æ…‹ç¢¼å¤§æ–¼ç­‰æ–¼300çš„IP:", $1}'
```

è¼¸å‡ºï¼š

```txt
ç‹€æ…‹ç¢¼å¤§æ–¼ç­‰æ–¼300çš„IP: 10.1.2.3
ç‹€æ…‹ç¢¼å¤§æ–¼ç­‰æ–¼300çš„IP: 172.16.4.5
```
